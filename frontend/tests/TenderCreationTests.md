# اختبار شامل لنظام إنشاء المناقصات

## سيناريوهات الاختبار

### 1️⃣ إنشاء المناقصة برقم مرجعي فريد

**الهدف**: التأكد من توليد رقم مرجعي فريد لكل مناقصة جديدة

**خطوات الاختبار**:

- الدخول إلى صفحة "إنشاء مناقصة جديدة"
- ملء الحقول الأساسية:
  - العنوان: "المناقصة الأولى"
  - الوصف: "اختبار توليد الرقم المرجعي"
- انقر "التالي" للانتقال لخطوة اللوطات
- أضف لوط واحد مع عدة مقالات
- استمر حتى النهاية
- اضغط "إنشاء الطلب"

**النتيجة المتوقعة**:

- ✅ يتم توليد رقم مرجعي فريد (مثل CONS-2024-001)
- ✅ يتم حفظ المناقصة بحالة "مسودة"
- ✅ عدم تكرار الرقم المرجعي لمناقصة أخرى

**معايير التحقق**:

```
- فحص رقم المناقصة في قاعدة البيانات: SELECT tender_number FROM tenders ORDER BY id DESC LIMIT 2;
- التأكد من أن الأرقام مختلفة وفريدة
```

---

### 2️⃣ تحميل الوثائق الأساسية

**الهدف**: التحقق من قبول النظام للوثائق الإلزامية والمحافظة على سلامة الملفات

**خطوات الاختبار**:

- اذهب إلى خطوة "الوثائق والملفات"
- اضغط على "إضافة وثيقة"
- اختر ملف PDF (كراس الشروط الإدارية)
- تحقق من:
  - نوع الملف (PDF, Word, Excel)
  - حجم الملف (أقل من 10MB)
  - اسم الملف

**النتيجة المتوقعة**:

- ✅ يتم قبول ملفات PDF و Word
- ✅ يتم رفض الملفات الأخرى (صور، أرشيفات، إلخ)
- ✅ يتم عرض رسالة خطأ واضحة للملفات المرفوضة
- ✅ يتم عرض حجم الملف والنوع

**معايير التحقق**:

```
- اختبر بملف PDF: يجب أن يُقبل
- اختبر بملف صورة (JPG): يجب أن يُرفض برسالة خطأ
- اختبر بملف كبير (>10MB): يجب أن يُرفض برسالة حجم
```

---

### 3️⃣ التحقق من صحة الآجال

**الهدف**: التأكد من رفض التواريخ المتضاربة وعرض رسائل خطأ واضحة

**حالات الاختبار**:

#### 3.1 تاريخ الإغلاق قبل تاريخ النشر

- تاريخ النشر: 2025-12-01
- تاريخ الإغلاق: 2025-11-30 (قبل النشر)
- **النتيجة المتوقعة**: ❌ رسالة خطأ: "تاريخ الإغلاق يجب أن يكون بعد تاريخ النشر"

#### 3.2 تاريخ في الماضي

- تاريخ الإغلاق: 2024-01-01 (تاريخ ماضي)
- **النتيجة المتوقعة**: ❌ رسالة خطأ: "التاريخ يجب أن يكون في المستقبل"

#### 3.3 تواريخ صحيحة

- تاريخ النشر: 2025-12-01
- تاريخ فتح الاستفسارات: 2025-12-02
- تاريخ الإغلاق: 2025-12-20
- **النتيجة المتوقعة**: ✅ يتم قبول البيانات والمتابعة

#### 3.4 تاريخ فتح الاستفسارات قبل النشر

- تاريخ النشر: 2025-12-01
- تاريخ فتح الاستفسارات: 2025-11-30
- **النتيجة المتوقعة**: ❌ رسالة خطأ واضحة

---

### 4️⃣ تحديد تفاصيل اللوطات والضمان المؤقت

**الهدف**: التأكد من إمكانية تقسيم المناقصة إلى لوطات وتحديد الضمان المؤقت

**خطوات الاختبار**:

- اذهب إلى خطوة "اللوطات"
- اضغط "إضافة لوط جديد"
- ملأ بيانات اللوط:
  - رقم اللوط: Lot 01
  - موضوع: "معدات الحاسوب"
  - الموازنة الدنيا: 1000 TND
  - الموازنة العليا: 5000 TND
  - الضمان المؤقت: 10% من الموازنة

**النتيجة المتوقعة**:

- ✅ يتم إضافة اللوط بنجاح
- ✅ يتم حساب الضمان المؤقت تلقائياً (10% = 500 TND)
- ✅ يمكن إضافة عدة لوطات
- ✅ يمكن حذف اللوط

**معايير التحقق**:

```
- تحقق من تخزين بيانات اللوط في JSONB
- تحقق من حساب الضمان بشكل صحيح
- تحقق من ظهور اللوطات في الملخص النهائي
```

---

### 5️⃣ نشر المناقصة العلني

**الهدف**: التأكد من ظهور المناقصة فوراً في القائمة العامة بعد النشر

**خطوات الاختبار**:

- أكمل إنشاء المناقصة (جميع الخطوات)
- اضغط "إنشاء الطلب"
- من صفحة تفاصيل المناقصة، اضغط "نشر"
- تحقق من الظهور العام

**النتيجة المتوقعة**:

- ✅ يتم تغيير الحالة من "مسودة" إلى "منشورة"
- ✅ تظهر المناقصة فوراً في قائمة المناقصات العامة
- ✅ يمكن للجمهور الوصول إليها
- ✅ يتم تحديث حالة النشر في قاعدة البيانات

**معايير التحقق**:

```sql
-- تحقق من حالة المناقصة
SELECT id, tender_number, title, status, is_public FROM tenders ORDER BY id DESC LIMIT 1;

-- يجب أن تكون النتيجة:
-- id | tender_number | title | status | is_public
-- 1  | CONS-2024-001 | ... | published | true
```

---

## ملخص معايير النجاح

| الميزة               | معيار النجاح                     | الحالة |
| -------------------- | -------------------------------- | ------ |
| الرقم المرجعي الفريد | توليد أرقام فريدة                | ✅     |
| تحميل الوثائق        | قبول PDF/Word ورفض الباقي        | ⏳     |
| التحقق من الآجال     | رفض التواريخ المتضاربة           | ⏳     |
| اللوطات والضمان      | إضافة/حذف واللواطات وحساب الضمان | ⏳     |
| النشر العام          | ظهور فوري في القائمة العامة      | ⏳     |

---

## خطوات الاختبار العملي

### الخطوة 1: إعداد بيانات الاختبار

```javascript
// بيانات مناقصة اختبار فعلية
const testTender = {
  title: 'اختبار النظام - المناقصة #1',
  description: 'مناقصة تجريبية لاختبار جميع المميزات',
  category: 'technology',
  budget_min: 1000,
  budget_max: 10000,
  publication_date: '2025-12-01',
  deadline: '2025-12-20',
  opening_date: '2025-12-21',
};
```

### الخطوة 2: الاختبار الفعلي

1. افتح http://your-app/create-tender
2. ملأ النموذج حسب البيانات أعلاه
3. ثبت كل خطوة
4. تحقق من النتائج

### الخطوة 3: التحقق من قاعدة البيانات

```bash
# قم بتشغيل queries للتحقق من البيانات
curl http://localhost:3000/api/procurement/tenders | jq .
```

---

## ملاحظات مهمة

- تأكد من تسجيل الدخول بحساب بائع قبل الاختبار
- استخدم تواريخ مستقبلية عند الاختبار
- احفظ أرقام المناقصات المنشأة للتحقق منها لاحقاً
- فعّل وضع المطورين في المتصفح للتحقق من الأخطاء
